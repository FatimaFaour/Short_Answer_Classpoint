<!DOCTYPE html>
<html>
<head>
  <title>Join Class</title>
</head>
<body>

<h2>Join Class</h2>

<input id="code" placeholder="Session Code"><br><br>
<input id="name" placeholder="Your Name"><br><br>
<button onclick="join()">Join</button>

<div id="question"></div>
<textarea id="answer" placeholder="Your answer"></textarea><br>
<button onclick="submit()">Submit</button>

<script>
let studentId = null;
let sessionId = null;
let questionId = null;

async function join() {
  const res = await fetch("http://127.0.0.1:8000/join", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      code: document.getElementById("code").value,
      nickname: document.getElementById("name").value
    })
  });
  const data = await res.json();
  studentId = data.student_id;
  sessionId = data.session_id;
  loadQuestion();
}

async function loadQuestion() {
  const res = await fetch(`http://127.0.0.1:8000/question/${sessionId}`);
  const data = await res.json();
  if (data.question) {
    questionId = data.id;
    document.getElementById("question").innerText = data.text;
  } else {
    document.getElementById("question").innerText = "Waiting for question...";
  }
}

async function submit() {
  await fetch("http://127.0.0.1:8000/answer", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      question_id: questionId,
      student_id: studentId,
      answer: document.getElementById("answer").value
    })
  });
  alert("Answer submitted!");
}
</script>

</body>
</html>
